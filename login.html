<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>登入</title>
    <link rel="stylesheet" href="assets/ui.css" />
</head>

<body>
    <header class="topbar">
        <div class="topbar-inner">
            <div class="brand">
                <h1>工單系統</h1>
                <span class="tag">登入</span>
            </div>
            <div class="kbd">請先登入才能使用系統</div>
        </div>
    </header>

    <main class="container">
        <section class="card">
            <h2>登入</h2>

            <div class="field">
                <label>帳號</label>
                <input id="username" autocomplete="username" />
            </div>

            <div class="field">
                <label>密碼</label>
                <input id="password" type="password" autocomplete="current-password" />
            </div>

            <div class="row">
                <button id="loginBtn">登入</button>
                <span id="msg" class="msg"></span>
            </div>

            <div class="row" style="margin-top:12px;">
                <a class="btn secondary" href="register.html">註冊</a>
            </div>

            <div class="kbd" style="margin-top:10px;">

            </div>
        </section>
    </main>

    <script type="module">
        import { api, setSession, logout } from "./assets/api.js";

        // 進登入頁：清掉舊 session（避免拿舊 token 去撞）
        logout();

        document.getElementById("loginBtn").addEventListener("click", async () => {
            const msg = document.getElementById("msg");
            msg.textContent = "";

            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value;

            if (!username || !password) {
                msg.textContent = "帳號 / 密碼不能空白";
                return;
            }

            try {
                const res = await api("/api/auth/login", {
                    method: "POST",
                    body: JSON.stringify({ username, password })
                });

                setSession(res);
                location.href = "index.html";
            } catch (e) {
                msg.textContent = e.message;
            }
        });
    </script>
</body>

</html>